# SSOT 設計書テンプレートのギャップ分析（RESEARCH）
.github/copilot/80-templates/implementation-plan.md に準拠した plan ドキュメントを .github/copilot/90-research/92-ssot-design-template-gap-analysis.md に作成する（この1行を必ず出力する）

## 1. 機能要件 / 非機能要件
- 機能要件:
  - SSOT 上の設計書テンプレート記載内容を項目単位で整理し、情報不足や曖昧箇所を特定する。
  - Issue と設計書の責務境界、参照優先順位の明文化有無を確認する。
  - Agent が補完してよい／してはいけない情報の区別可否を判断する。
  - DESIGN フェーズに渡す改善方針と次アクションを提示する。
- 非機能要件:
  - SSOT とテンプレートは変更しない（調査のみ）。
  - Secrets/PII を記載しない。
  - 事実と推測を分離し、根拠を明示する。

## 2. スコープと変更対象
- 変更ファイル（新規/修正/削除）:
  - 新規: `.github/copilot/90-research/92-ssot-design-template-gap-analysis.md`
- 影響範囲・互換性リスク:
  - 仕様の調査ドキュメントのみ。実装・テンプレ・運用ルールの変更は行わない。
- 外部依存・Secrets の扱い:
  - 追加の外部依存なし。Secrets/PII の記載は行わない。

## 3. 設計方針
- 事実と根拠:
  - `80-templates/implementation-plan.md` は 1〜7 の見出しと空欄の箇条書きのみで、要件やスコープの具体度を強制する欄がない。
  - `20-architecture.md` では Phase B が「確定 plan の範囲で実装」と記述される一方、Issue のゴール文を無視する明示ルールはない。
  - `10-requirements.md` は「80-templates を用いた設計出力が必須」とのみ記載し、設計書不足時の扱いが定義されていない。
  - `00-index.md` の参照順はあるが、Issue/plan の優先順位を明示する項目はない。
- 原因仮説の切り分け結果:
  - Agent 要因: Issue のゴール文を優先しやすい学習バイアスがある可能性。
  - テンプレ要因: 具体的な仕様定義や In/Out を強制する欄がなく、空欄でも完了扱いになり得る。
  - 運用要因: plan の粒度チェックが明文化されておらず、レビュー時の合意基準が曖昧。
- 選択肢（Pros / Cons）:
  - SSOT 修正（10-20 の責務・優先順位を明示）
    - Pros: 参照優先順位と責務境界を全体で統一できる。
    - Cons: 仕様層改訂の合意形成が必要。
  - テンプレ粒度強化（plan に「仕様定義」「決定事項」「未確定事項」欄を追加）
    - Pros: 空欄の plan を抑止し、補完禁止の基準を作れる。
    - Cons: 設計作業の負荷が増える。
  - Issue 側ルール補強（Design Issue に「plan が唯一の仕様」チェックリストを追加）
    - Pros: 変更範囲が運用に限定され、導入が容易。
    - Cons: テンプレ自体の曖昧さは残り、属人的運用に依存。
- 推奨案:
  - テンプレ粒度強化を主軸にし、SSOT（10-20）へ「plan が唯一の仕様」「未記載は未確定」ルールを追加する方針を DESIGN に提案する。
  - 運用として、Design Review で「機能要件／スコープ／設計詳細が全て具体化されていること」を合否基準にする。
- エッジケース / 例外系 / リトライ方針:
  - Issue のゴールのみが明確で plan が空欄の場合、補完せず差し戻す運用を明文化する必要がある。
- ログと観測性（漏洩防止を含む）:
  - 調査ドキュメントのみのため新規ログは不要。

## 4. テスト戦略
- テスト観点（正常 / 例外 / 境界 / 回帰）:
  - 文書構成がテンプレートに準拠していることをレビューで確認する。
- モック / フィクスチャ方針:
  - 該当なし。
- テスト追加の実行コマンド（例: `python -m pytest`）:
  - `npm test`

## 5. CI 品質ゲート
- 実行コマンド（format / lint / typecheck / test / security）:
  - `npm test`
- 通過基準と失敗時の対応:
  - 既存の lint / test / build が成功すること。失敗時は調査作業を中断し、原因を切り分ける。

## 6. ロールアウト・運用
- ロールバック方法:
  - 追加した調査ドキュメントを削除して元に戻す。
- 監視・運用上の注意:
  - ドキュメントのみのため監視は不要。

## 7. オープンな課題 / ADR 要否
- 未確定事項:
  - 「plan に未記載の場合は補完禁止」を SSOT にどのレイヤで明記するか（10/20/80 のいずれか）。
  - Design Review の合否基準を ADR に残すか否か。
- ADR に残すべき判断:
  - テンプレートの粒度強化方針を採用する場合、変更理由と適用範囲の ADR 化を検討する。
- 次アクション（DESIGN Issue 化の入力情報）:
  - 追記すべき SSOT 項目案（Issue/plan の優先順位、未記載は未確定、補完禁止ルール）。
  - テンプレート追加項目案（仕様定義、決定事項、未確定事項、Issue ゴールとの差分）。
  - Review チェックリスト案（機能要件/スコープ/設計詳細の具体度）。
