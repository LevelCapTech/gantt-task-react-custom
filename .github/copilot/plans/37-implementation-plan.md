# 1. 機能要件 / 非機能要件
- 機能要件:
  - 初期描画時に Task Table を 450px、Schedule Table を残り幅で表示する。
  - Task/Schedule 間にドラッグ可能な分割ハンドルを配置し、左右幅を変更できる（両ペイン最小幅 150px）。
  - Task/Schedule の分割ハンドルを維持し、Task=450px / Schedule=残り幅で初期表示する。
  - Task/Schedule の分割比は永続化しない（リロードで初期値）。
  - Task 側の水平スクロール追加を撤回し、Task 側は領域内に収める（クリップ/省略）。
  - ドラッグ中にポインタが領域外へ移動しても終了できるようにする（pointer capture 等）。
- 非機能要件:
  - DOM 変更とスタイル追加は最小限に留め、既存挙動（クリック・選択・展開）を阻害しない。
  - 外部サービス・Secrets は扱わない。ログ出力は増やさない。
  - 互換性を維持し、OS 依存のスクロールバー非表示は許容する（独自スクロールバーは実装しない）。

# 2. スコープと変更対象
- 変更ファイル（新規/修正/削除）:
  - 修正: `src/components/gantt/gantt.tsx`（2ペイン構造と幅状態の管理・ドラッグイベント）
  - 修正: `src/components/task-list/*`（Task 表の横方向クリップ）
  - 修正: 関連スタイルファイル（分割ハンドル、Task 表のオーバーフロー制御）
  - テスト: 必要に応じて既存テストの更新または追加
- 影響範囲・互換性リスク:
  - レイアウトコンテナの構造変更によるスタイル衝突リスク。最小幅制約計算の誤りによるレイアウト破綻リスク。
  - 既存のスクロール・選択イベントと分割ハンドルイベントが干渉しないよう document-level リスナーで終了を保証。
- 外部依存・Secrets の扱い:
  - 新規外部依存は追加しない。Secrets 利用なし。

# 3. 設計方針
- 責務分離 / データフロー:
  - ガント全体コンテナで Task/Schedule の幅状態 (`taskPaneWidth`, `schedulePaneWidth`) を管理。初期値 450px を設定し、コンテナ幅から残差をスケジュールに割り当てる。
  - 分割ハンドルは両ペイン間に配置し、pointer/mouse イベントでドラッグ量を算出。コンテナ幅と最小幅 150px を基準に clamp して状態更新。
  - Task Table は横方向オーバーフローをクリップし、領域内に収める（水平スクロールなし）。
  - Schedule Table の既存スクロール構造は維持し、同期や永続化は行わない。
- エッジケース / 例外系 / リトライ方針:
  - コンテナ幅が 300px 未満の場合でも両側 150px を下回らないよう clamp し、さらなる縮小操作は無効化。
  - ドラッグ中にポインタが外れても pointer capture / document-level リスナーで終了を保証。
  - ウィンドウリサイズ時は Task 450px を上限に、コンテナ幅に応じて再計算（最小幅を優先）。
- ログと観測性（漏洩防止を含む):
  - ライブラリのため新規ログは追加しない。エラーは throw せず安全に無視または clamp 処理。

# 4. テスト戦略
- テスト観点（正常 / 例外 / 境界 / 回帰）:
  - 初期幅が Task 450px / Schedule 残りになることの検証。
  - ドラッグで幅が変化し、両側が 150px 未満にならないことの検証。
  - Task 側の横スクロールが発生せず、Schedule 側が押し出されないことの検証。
  - 分割比を変更してもスクロール同期や永続化が発生しないことの回帰確認。
- モック / フィクスチャ方針:
  - DOM イベント（pointer/mouse）をシミュレートするユニット/コンポーネントテストを優先。スクロール位置は scrollLeft の数値検証で代替。
- テスト追加の実行コマンド（例: `python -m pytest`）:
  - `npm run test:unit`（必要に応じて追加/更新）
  - `npm run test:lint`
  - `npm run test:build`

# 5. CI 品質ゲート
- 実行コマンド（format / lint / typecheck / test / security）:
  - `npm run test:lint`
  - `npm run test:unit`
  - `npm run test:build`
- 通過基準と失敗時の対応:
  - すべてのコマンドがエラーなしで完了すること。新規警告は修正し、既存警告は逸脱がないか確認。

# 6. ロールアウト・運用
- ロールバック方法:
  - 幅状態管理と分割ハンドル、Task Table スクロールコンテナ統合の変更を削除し、従来の固定レイアウトとスクロール構造に戻す。
- 監視・運用上の注意:
  - 利用アプリ側でカスタム CSS がある場合、分割ハンドルや新規コンテナに干渉しないか確認。永続化や同期が必要なら別 Issue として props 拡張を検討。

# 7. オープンな課題 / ADR 要否
- 未確定事項:
  - なし（分割比永続化・同期はスコープ外として確定）。
- ADR に残すべき判断:
  - なし（既存設計方針に沿う小変更のため不要）。

# 8. 参照
- [00-index.md](../00-index.md)
- [10-requirements.md](../10-requirements.md)
- [20-architecture.md](../20-architecture.md)
- [40-testing-strategy.md](../40-testing-strategy.md)
- [60-ci-quality-gates.md](../60-ci-quality-gates.md)
