# 1. 機能要件 / 非機能要件
- 機能要件:
  - 下段スクロールバー行を「左: Task Table / 中: 分割バー / 右: Gantt 本体」の3カラム構造に変更する。
  - 左スクロールは Task Table（ヘッダ＋ボディ）へ反映し、右側へ影響させない。
  - 右スクロールは Gantt 本体（グリッド・バー・カレンダー）へ反映し、左側へ影響させない。
  - 下段の分割バーは上段と同一のドラッグ操作で Task/Gantt の幅を変更できる。
  - 既存のホイール/キー操作は従来通りに動作し、下段入力追加で破壊しない。
- 非機能要件:
  - 既存 API と互換性を保ち、既存の挙動や props を変更しない。
  - 追加の外部依存や Secrets を導入しない。
  - スクロールイベントの干渉を防ぐため、左右のループ防止フラグを独立させる。

# 2. スコープと変更対象
- 変更ファイル（新規/修正/削除）:
  - 修正: `src/components/gantt/gantt.tsx`（左右スクロール state/イベント分離、下段レイアウト3カラム化）
  - 修正: `src/components/other/horizontal-scroll.tsx`（左右専用化に伴う API/スタイル調整）
  - 修正: `src/components/gantt/gantt.module.css`（下段スクロールバー行の3カラム配置）
  - テスト: `src/test/*` 既存テストの追加/更新（左右独立スクロールと分割バーの回帰）
- 影響範囲・互換性リスク:
  - 下段スクロールバー行の DOM 構造変更による CSS 上書き影響。
  - スクロール state の増設に伴う同期ズレ・イベントループのリスク。
- 外部依存・Secrets の扱い:
  - 新規依存なし。Secrets/PII は扱わない。

# 3. 設計方針
- 責務分離 / データフロー:
  - 左右スクロールは `scrollXLeft` / `scrollXRight` に分離し、Task Table と Gantt 本体へ個別に反映する。
  - ループ防止フラグは左右独立で保持し、片側の programmatic scroll が他方の入力を抑止しないようにする。
  - 下段スクロールバー行は `taskListWidth / splitterWidth / 1fr` の3カラムレイアウトで上下段を揃える。
  - 分割バーは既存のハンドル UI を上下段で共有し、同一のドラッグハンドラで幅変更を行う。
- エッジケース / 例外系 / リトライ方針:
  - `listCellWidth` 未設定時は Task Table を非表示とし、下段左スクロールも非表示にする。
  - コンテナ幅が最小幅を下回る場合は既存の clamp 処理を維持して破綻を防ぐ。
  - `ignore` フラグの誤設定による無限ループを避けるため、更新は最新値のみ反映する。
- ログと観測性（漏洩防止を含む）:
  - 新規ログは追加せず、機微情報は出力しない。

# 4. テスト戦略
- テスト観点（正常 / 例外 / 境界 / 回帰）:
  - 左スクロール操作が Task Table のみを動かすことの確認。
  - 右スクロール操作が Gantt 本体のみを動かし、Calendar が追従することの確認。
  - 左右スクロールを交互に操作しても同期しないことの回帰確認。
  - 下段分割バー操作で上下段の分割位置が一致することの確認。
- モック / フィクスチャ方針:
  - React Testing Library の scroll イベントを用い、`scrollLeft` の変化を検証する。
- テスト追加の実行コマンド（例: `python -m pytest`）:
  - `npm run test:unit`

# 5. CI 品質ゲート
- 実行コマンド（format / lint / typecheck / test / security）:
  - `npm run test:lint`
  - `npm run test:unit`
  - `npm run test:build`
- 通過基準と失敗時の対応:
  - すべてのコマンドが成功すること。失敗時は変更範囲内で修正し再実行する。

# 6. ロールアウト・運用
- ロールバック方法:
  - 下段スクロールバー行を従来の1本構成に戻し、左右スクロール state を削除する。
- 監視・運用上の注意:
  - DOM/CSS 変更により利用側のカスタム CSS に影響がないか確認する。

# 7. オープンな課題 / ADR 要否
- 未確定事項:
  - 分割バー幅は既存定数（splitterWidth）と一致させる。
- ADR に残すべき判断:
  - なし（既存設計に沿うため）。
