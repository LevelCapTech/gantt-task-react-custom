# 1. ゴール / 非ゴール
- ゴール: `dnd-kit` を用いてタスク行のドラッグ＆ドロップ並べ替えと階層化（親子変更）の PoC を `/src/dnd/` 配下に実装し、Gantt 表示とタスクリストの状態同期可能性を検証する。
- 非ゴール: 本体コンポーネントの挙動変更や API 追加、ドラッグ UI を本番実装として導入すること。期間バーのドラッグ操作は範囲外。

# 2. スコープと変更対象
- 変更ファイル（新規/修正/削除）: `/src/dnd/` 配下に PoC 実装（SortableContext/DragHandle/階層化ロジック）とユーティリティ、検証ログ用ドキュメント（例: `docs/research-dnd-kit.md`）。`package.json` への dnd-kit 依存追加、PoC を目視できるサンプル UI（必要に応じて example 配下で限定的に追加）。
- 影響範囲・互換性リスク: 本体エクスポートは変更しない想定。PoC は隔離し既存ビルドに影響しないように命名空間を分離。依存追加は dnd-kit 系のみに限定。
- 外部依存・Secrets の扱い: dnd-kit のみ追加予定。Secrets 利用なし。

# 3. 設計方針
- 責務分離 / データフロー: `SortableContext` と `DragOverlay` を使い、タスクリスト項目をハンドル経由でドラッグ可能にする。並べ替えとインデント変更を純関数ユーティリティで管理し、その結果を Gantt に渡す。Gantt 描画は既存コンポーネントを再利用。
- エッジケース / 例外系 / リトライ方針: ルートタスクの負のインデント禁止、親がタスクタイプ以外の場合のスキップ、循環親子の防止などをユーティリティ側で制約。ドラッグキャンセル時は元順序へ戻す。
- ログと観測性（漏洩防止を含む）: PoC 内のログは console に限定し、ID/名称のみを出力。Secrets/PII は扱わない。

# 4. テスト戦略
- テスト観点（正常 / 例外 / 境界 / 回帰）: 並べ替え・インデント変更ユーティリティの純関数テスト（順序維持、子再配列、無効操作の無視）。UI 部分は手動確認。
- モック / フィクスチャ方針: タスク配列のフィクスチャを用意し、純関数テストで活用。外部モック不要。
- テスト追加の実行コマンド: `npm test -- --watch=false`（既存 Jest に統合）。

# 5. CI 品質ゲート
- 実行コマンド（format / lint / typecheck / test / security）: `npm test -- --watch=false` を実行（lint/typecheck/build 含む）。依存追加時は `npm install` 済みを前提に同コマンドで確認。
- 通過基準と失敗時の対応: すべてのサブコマンド成功。失敗時は該当ユーティリティや型定義を修正し再実行。

# 6. ロールアウト・運用
- ロールバック方法: `/src/dnd/` 追加ファイルと dnd-kit 依存を戻す／削除する。サンプル UI 変更も同様にリバート。
- 監視・運用上の注意: PoC コードのため本番リリースには含めず、example での確認に限定。

# 7. オープンな課題 / ADR 要否
- 未確定事項: 最終的な階層変更仕様（最大深さ、兄弟順の扱い）。collisionDetection チューニングの詳細。
- ADR に残すべき判断: 本番導入時に必要。現フェーズでは調査ログを `docs/research-dnd-kit.md` に残す。
